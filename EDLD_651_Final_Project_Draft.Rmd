---
title             : "EDLD 651 Final Project Draft"
shorttitle        : "New York City Graduation Outcome by Borough and Student Classification"

author: 
  - name          : "Anwesha Guha"
    affiliation   : "1"

  - name          : "Heidi Iwashita"
    affiliation   : "1"

  - name          : "Christopher Loan"
    affiliation   : "1"

  - name          : "Adam Nielsen"
    affiliation   : "1"

  - name          : "Aaron Rothbart"
    affiliation   : "1"

affiliation:
  - id            : "1"
    institution   : "University of Oregon"

authornote: |
  All work done herein represents contributions from all authors equally. Author order is alphabetical. 

abstract: |
 FILL IN ABSTRACT IF WANTED
  
keywords          : "keywords"
wordcount         : "X"

bibliography      : ["r-references-final-project.bib"]

floatsintext      : no
figurelist        : no
tablelist         : no
footnotelist      : no
linenumbers       : yes
mask              : no
draft             : no
url_color         : blue

documentclass     : "apa6"
classoption       : "man, fleqn, noextraspace"
output            : papaja::apa6_pdf

header-includes:
  - \raggedbottom
  - \setlength{\parskip}{0pt}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = FALSE,
                      fig.height = 8,    
                      fig.width = 8)
library(papaja)
library(tidyverse)
library(janitor)
library(rio)
library(here)
library(knitr)
theme_set(theme_minimal())
r_refs("r-references-final-project.bib") # we'll have to actually add this if we cite the packages, data, etc. (HEIDI)
```

# Introduction

We explore proportion of graduation (outcome), across several categorical variables. In particular, we plan to focus on comparisons of two groups who have historically had unequal access to resources: English language learners (ELL) vs. English proficient (EP) students & Special Education (SPED) status vs. non-SPED status.

Not only will we report these outcomes across different groups, we will also explore these across boroughs, too, to see if these groups are succeeding equally across boroughs—-as measured by graduation outcomes—-compared to the English proficient students in their boroughs. 

# Methods

We retrieved the data collected by the Department of Education from  

Information about variables, how they were measured here

Information about regents examinations here

## Participants

Explain participants' from what we have in data.

First, we import and clean our data:
```{r import_and_clean}

raw_grad <- import(here("data", "grad.csv"))
grad <- raw_grad %>% 
  clean_names() %>% 
  as_tibble()

summary(grad$cohort) # we see here that 'Aug 2006' needs to be changed to '2006' for consistency

grad$cohort <-  as.numeric(sub("Aug 2006", "2006", grad$cohort))

head(grad)

```

## PIVOTS

The data we are starting with are already tidy, but for the purposes of demonstrating our rather acute proficiency in our _ability_ to tidy data, in this segment will make the data untidy and then tidy it once more.

```{r pivots, echo=T}
messy_grad <- grad %>% 
  pivot_wider(names_from = borough,
              values_from = total_cohort)

clean_grad <- messy_grad %>% 
  pivot_longer(cols = c("Bronx":"Staten Island"),
               names_to = "borough",
               values_to = "total_cohort",
               values_drop_na = TRUE)

clean_grad <- clean_grad[, c(1,21,2,22,3:20)]

```

Now that we have tidied the entire dataset, we can focus on our variables of interest: enrollment and graduation for specific boroughs, cohorts and demographics.

```{r select, filter, mutate}

filtered_grad <- clean_grad %>%
  select(c(1:6, 16:22)) %>%
  filter(demographic == "English Language Learners" |
         demographic == "English Proficient Students" |
         demographic == "Special Education" |
         demographic == "General Education") %>% 
  mutate(student_characteristic = 
           factor(demographic, 
                  levels = c("English Language Learners", 
                      "English Proficient Students", 
                      "Special Education", 
                      "General Education"), 
                  labels = c('ELL', 'EP', 'SPED', 'Non-SPED')
                  ))

new_grad <- filtered_grad %>%
  mutate(unclassified_n = total_cohort - (total_grads_n + dropped_out_n + still_enrolled_n),
         unclassified_percent_of_cohort = round(unclassified_n/total_cohort * 100, 1))

```


```{r summary stats}
head(new_grad)

# group by relevant demographics (ELL & EP, GE & SPED)
demographic_data <- new_grad %>% 
  group_by(student_characteristic, cohort) %>% 
  summarize(mean_grad_pct = mean(total_grads_percent_of_cohort),
            mean_dropout_pct = mean(dropped_out_percent_of_cohort),
            mean_enrolled_pct = mean(still_enrolled_percent_of_cohort),
            mean_unclassified_pct = mean(unclassified_percent_of_cohort))

# group by borough, look at % of local students
borough_data <- new_grad %>% 
  group_by(borough, cohort) %>% 
  summarize(mean_local = mean(local_percent_of_cohort),
            mean_grad_pct = mean(total_grads_percent_of_cohort),
            mean_dropout_pct = mean(dropped_out_percent_of_cohort),
            mean_enrolled_pct = mean(still_enrolled_percent_of_cohort),
            mean_unclassified_pct = mean(unclassified_percent_of_cohort))
```


```{r descriptives_of_dataset}
demographic_bar <- demographic_data %>% 
  pivot_longer(cols = contains("mean"),
               names_to = c("characteristic", ".value"),
               names_prefix = "mean_",
               names_sep = "_")

# which makes more sense?
# Option 1 - cohort as factor(), faceted by characteristic
# demographic_bar %>% 
#   ggplot(aes(fill = factor(cohort), x = student_characteristic, y = pct)) +
#   geom_bar(position = "stack", stat = "identity") +
#   theme(axis.text.x = element_text(angle = 60)) +
#   facet_grid(~characteristic + cohort) +
#   scale_fill_viridis_d()

# Option 2 - cohort and characteristic switched
demographic_bar %>% 
  ggplot(aes(fill = characteristic, x = student_characteristic, y = pct)) +
  geom_bar(position = "stack", stat = "identity") +
  theme(axis.text.x = element_text(angle = 60)) +
  facet_wrap(~cohort) +
  scale_fill_viridis_d()


# We can also look at the following to get a general sense of the data:
# - total cohorts/grads, facet_wrap by borough
# - grad percentage by student_characteristic, then can do a deeper dive by borough
# - the above two repeated with dropout rate
```

## Data analysis

All analysis were conducted in R, with heavy reliance upon the `{tidyverse}` packages to manipulate and visualize the data.

# Results

Visual inspection of Figure 1 demonstrates heterogeneity in the gaps between ELL and EP students. Certain Boroughs (e.g., Staten Island) have much larger gaps between proficiency than others (e.g., Brooklyn). From a social justice framework, it is concerning that this gap is not equal across boroughs. Ideally, any difference in graduation based on EL status between students would be constant despite location. Without follow-ups to gather more qualitative (or highly dimensional quantitative) data, it is difficult to explain why Boroughs with higher EP graduation rates do not have correspondingly higher ELL graduation rates. 
    

***

**SPED status**
- Gaps between SPED and non-SPED students appear relatively constant across borough
- Some boroughs (i.e., Staten Island & Manhattan) have higher graduation percentages for both groups. 


```{r report_results}

#report graduation by borough
#report graduation by english language status
#report graduation by SPED status
#report graduation by borough & SPED status
#report graduation by borough & english learner status
```


```{r graph_results_EL_graph, echo=FALSE, fig.width = 12, fig.height = 8}

group_means <- new_grad %>%
    filter(student_characteristic == "ELL" | 
           student_characteristic == "EP") %>%
  group_by(student_characteristic, borough) %>% 
  summarise(avg = mean(total_grads_percent_of_cohort))

new_grad %>% 
  filter(student_characteristic == "ELL" | 
           student_characteristic == "EP") %>% 
  mutate(Cohort = factor(cohort)) %>% 
  group_by(student_characteristic, borough) %>% 
  ggplot(aes(x = student_characteristic, 
             y = total_grads_percent_of_cohort)) +
  geom_jitter(aes(color = Cohort)) + 
  geom_hline(data = group_means, 
             aes(yintercept = avg), 
             linetype = "dashed", 
             size = 1.5
             ) +
  facet_wrap(~borough) + 
  labs(title = 'Figure 1. Graduation Rates in NYC by EL Status',
       subtitle = 'Dashed lines represent Borough average for each group',
       y = 'Percent of total cohort',
       x = 'Student Characteristic') + 
  theme(text = element_text(size = 20))

```



```{r graph_results_SPED, echo=FALSE, fig.width = 12, fig.height = 8}
group_means_2 <- new_grad %>%
    filter(student_characteristic == "SPED" | 
           student_characteristic == "Non-SPED") %>% 
  group_by(student_characteristic, borough) %>% 
  summarise(avg = mean(total_grads_percent_of_cohort))

new_grad %>% 
  filter(student_characteristic == "SPED" | 
           student_characteristic == "Non-SPED") %>% 
  mutate(Cohort = factor(cohort)) %>% 
  group_by(student_characteristic, borough) %>% 
  ggplot(aes(x = student_characteristic, 
             y = total_grads_percent_of_cohort)) +
  geom_jitter(aes(color = Cohort)) + 
  geom_hline(data = group_means_2, 
             aes(yintercept = avg), 
             linetype = "dashed", 
             size = 1.5
             ) +
  facet_wrap(~borough) + 
  labs(title = 'Figure 2. Graduation Rates in NYC by SPED Status',
       subtitle = 'Dashed lines represent Borough average for each group',
       y = 'Percent of total cohort',
       x = 'Student Characteristic')+ 
  theme(text = element_text(size = 20))      
```

# Discussion


**Inferential statistics:** test if differences are significant

**Consult experts & educational theorists:** 
- identify potential confounding variables which explain the variation in these averages (particularly for ELL/EP); e.g.,
    - School-wide access to funding & resources
    - Percent of teachers that speak languages other than English,
    - Predominant non-English language(s) is/are spoken in each borough
    - Average qualification of SPED/ELL teachers
    - Parental access to (and leverage of) extra-curricular educational resources


Differences appear to be blah by blah for blah. XYZ boroughs should consider blah blah blah, based on the results. Inferential tests are recommended for next directions.

\newpage

# References
\begingroup
\setlength{\parindent}{-0.5in}
\setlength{\leftskip}{0.5in}

<div id="refs" custom-style="Bibliography"></div>
\endgroup
