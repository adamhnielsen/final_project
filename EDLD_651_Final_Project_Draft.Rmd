---
title             : "EDLD 651 Final Project Draft"
shorttitle        : "Final_Draft"

author: 
  - name          : "Anwesha Guha"
    affiliation   : "1"

  - name          : "Heidi Iwashita"
    affiliation   : "1"

  - name          : "Christopher Loan"
    affiliation   : "1"

  - name          : "Adam Nielsen"
    affiliation   : "1"

  - name          : "Aaron Rothbart"
    affiliation   : "1"

affiliation:
  - id            : "1"
    institution   : "University of Oregon"

authornote: |
  All work done herein represents contributions from all authors equally. Author order is alphabetical. 

abstract: |
 FILL IN ABSTRACT IF WANTED
  
keywords          : "keywords"
wordcount         : "X"

bibliography      : ["r-references-final-project.bib"]

floatsintext      : no
figurelist        : no
tablelist         : no
footnotelist      : no
linenumbers       : yes
mask              : no
draft             : no
url_color         : blue

documentclass     : "apa6"
classoption       : "man, fleqn, noextraspace"
output            : papaja::apa6_pdf

header-includes:
  - \raggedbottom
  - \setlength{\parskip}{0pt}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      fig.height = 8,    
                      fig.width = 8)
library(papaja)
library(tidyverse)
library(janitor)
library(rio)
library(here)
library(knitr)
theme_set(theme_minimal())
r_refs("r-references-final-project.bib") # we'll have to actually add this if we cite the packages, data, etc.
```

# Introduction

We explore proportion of graduation (outcome), across several categorical variables. In particular, we plan to focus on English learners vs. English proficient students.

Not only will we report these outcomes across different groups, we will also explore these across boroughs, too, to see if English learners are succeeding equally across boroughs, compared to the English proficient students in their boroughs. 

# Methods

We retrieved the data collected by the Department of Education from [*NYC OpenData*](https://data.cityofnewyork.us/Education/2005-2010-Graduation-Outcomes-By-Borough/avir-tzek). It details graduation outcome information for the classes of 2005 to 2010.

Information about variables, how they were measured here

Information about regents examinations here

## Participants

Explain participants' from what we have in data.

First, we import and clean our data:
```{r import_and_clean}

raw_grad <- import(here("data", "2005-2010__Graduation_Outcomes_-__By_Borough.csv"))
grad <- raw_grad %>% 
  clean_names() %>% 
  as_tibble()

summary(grad$cohort) # we see here that 'Aug 2006' needs to be changed to '2006' for consistency

grad$cohort <-  as.numeric(sub("Aug 2006", "2006", grad$cohort))

head(grad) #need to change var names to make legible, perhaps subset data to only include the variables we are interested in and want to display
```

## PIVOTS

The data we are starting with are already tidy, but for the purposes of demonstrating our rather acute proficiency in our _ability_ to tidy data, in this segment will make the data untidy and then tidy it once more.

```{r pivots}
messy_grad <- grad %>% 
  pivot_wider(names_from = borough,
              values_from = total_cohort)
head(messy_grad)

clean_grad <- messy_grad %>% 
  pivot_longer(cols = c("Bronx":"Staten Island"),
               names_to = "borough",
               values_to = "total_cohort",
               values_drop_na = TRUE)

clean_grad <- clean_grad[, c(1,21,2,22,3:20)]
apa_table(clean_grad)

head(clean_grad)
```

Now that we have tidied the entire dataset, we can focus on our variables of interest: enrollment and graduation for specific boroughs, cohorts and demographics.

```{r select, filter, mutate}

filtered_grad <- clean_grad %>%
  select(c(1:6, 16:22)) %>%
  filter(demographic == "English Language Learners" |
         demographic == "English Proficient Students" |
         demographic == "Special Education" |
         demographic == "General Education")

new_grad <- filtered_grad %>%
  mutate(unclassified_n = total_cohort - (total_grads_n + dropped_out_n + still_enrolled_n),
         unclassified_percent_of_cohort = round(unclassified_n/total_cohort * 100, 1))

```


```{r summary stats}
head(new_grad)

# group by relevant demographics (ELL & EP, GE & SPED)
demographic_data <- new_grad %>% 
  group_by(demographic, cohort) %>% 
  summarize(mean_grad_pct = mean(total_grads_percent_of_cohort),
            mean_dropout_pct = mean(dropped_out_percent_of_cohort),
            mean_enrolled_pct = mean(still_enrolled_percent_of_cohort),
            mean_unclassified_pct = mean(unclassified_percent_of_cohort))

# group by borough, look at % of local students
borough_data <- new_grad %>% 
  group_by(borough, cohort) %>% 
  summarize(mean_local = mean(local_percent_of_cohort),
            mean_grad_pct = mean(total_grads_percent_of_cohort),
            mean_dropout_pct = mean(dropped_out_percent_of_cohort),
            mean_enrolled_pct = mean(still_enrolled_percent_of_cohort),
            mean_unclassified_pct = mean(unclassified_percent_of_cohort))
```


```{r descriptives_of_dataset}
demographic_bar <- demographic_data %>% 
  pivot_longer(cols = contains("mean"),
               names_to = c("characteristic", ".value"),
               names_prefix = "mean_",
               names_sep = "_")

# which makes more sense?
# Option 1 - cohort as factor(), faceted by characteristic
# demographic_bar %>% 
#   ggplot(aes(fill = factor(cohort), x = demographic, y = pct)) +
#   geom_bar(position = "stack", stat = "identity") +
#   theme(axis.text.x = element_text(angle = 60)) +
#   facet_grid(~characteristic + cohort) +
#   scale_fill_viridis_d()

# Option 2 - cohort and characteristic switched
demographic_bar %>% 
  ggplot(aes(fill = characteristic, x = demographic, y = pct)) +
  geom_bar(position = "stack", stat = "identity") +
  theme(axis.text.x = element_text(angle = 60)) +
  facet_wrap(~cohort) +
  scale_fill_viridis_d()


# We can also look at the following to get a general sense of the data:
# - total cohorts/grads, facet_wrap by borough
# - grad percentage by demographic, then can do a deeper dive by borough
# - the above two repeated with dropout rate
```

## Data analysis

All analysis were conducted in R, with heavy reliance upon the `{tidyverse}` packages to manipulate and visualize the data.

# Results


```{r report_results}

#report graduation by borough
#report graduation by english language status
#report graduation by borough & english learner status
```


```{r graph_results} 
#Chris Loan would like to do this part: graphing. 
# my code works assuming we use the "clean_grad" dataset in the `final_project.Rmd` file. You can get it to run there.

#graph outcomes by English language status
#facet wrap by borough
#jitter the points so we can see all the years
#give color to all the years so we can differentiate them

clean_grad %>% 
  filter(demographic == "English Language Learners" | 
           demographic == "English Proficient Students") %>% 
  mutate(`English Language Learner Status` = 
           factor(demographic, 
                  levels = c("English Language Learners", 
                      "English Proficient Students"), 
                  labels = c('Learner', 'Proficient')
                  )
         ) %>% group_by(`English Language Learner Status`, borough) %>% 
  ggplot(aes(x = `English Language Learner Status`, 
             y = total_grads_percent_of_cohort)) +
  geom_jitter(aes(color = cohort)) + facet_wrap(~borough) + 
  labs(title = 'Figure 1. Graduation Rates in NYC by English Learner Status',
       subtitle = 'Boroughs are reported separetely with lighter dots indicating more recent years',
       y = 'Percent of total cohort')


```


# Discussion

Differences appear to be blah by blah for blah. XYZ boroughs should consider blah blah blah, based on the results. Inferential tests are recommended for next directions.

\newpage

# References
\begingroup
\setlength{\parindent}{-0.5in}
\setlength{\leftskip}{0.5in}

<div id="refs" custom-style="Bibliography"></div>
\endgroup
